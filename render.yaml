services: 
  - type: web
    name: hotel10-server
    env: node
    buildCommand: npm install
    startCommand: npm run start:prod

    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: hotel10-database
          property: connectionString

    buildFilter:
      paths:
        - "prisma/**"
        - "src/**"

    buildScript:
      command: |
        echo "🚀 Running Prisma Client Generation..."
        npx prisma generate

        echo "📦 Pushing schema to the database (Prisma DB Push)..."
        npx prisma db push --accept-data-loss

        echo "📋 Verifying tables created in public schema..."
        apt-get update && apt-get install -y postgresql-client

        echo "🔍 Listing public tables from database:"
        psql "$DATABASE_URL" -c "\dt public.*"

        echo "✅ Done."
